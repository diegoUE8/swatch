{"version":3,"file":"src/js/main.server.js","sources":["../../src/environment/environment.js","../../src/js/main.server.js"],"sourcesContent":["export const environment = {\r\n\tappKey: 'ab4289a46cd34da6a61fd8d66774b65f',\r\n\tappCertificate: '',\r\n\tchannelName: 'Channel',\r\n\tport: 5000,\r\n\tapiEnabled: false,\r\n\tpaths: {\r\n\t\tmodels: 'models/',\r\n\t\ttextures: 'textures/',\r\n\t}\r\n};\r\n","const express = require('express');\r\nconst https = require('https');\r\nconst fs = require('fs');\r\nconst bodyParser = require('body-parser');\r\n\r\nconst path = require('path');\r\nconst { RtcTokenBuilder, RtmTokenBuilder, RtcRole, RtmRole } = require('agora-access-token');\r\n\r\nimport { environment } from '../environment/environment';\r\n\r\nconst PORT = process.env.PORT || environment.port;\r\n\r\nconsole.log(environment);\r\n\r\nvar app = express();\r\n\r\napp.disable('x-powered-by');\r\n\r\napp.use(express.static(path.join(__dirname, '../../docs/')));\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(bodyParser.json());\r\napp.use(bodyParser.raw());\r\n\r\n// app.use(express.favicon());\r\n\r\n/*\r\napp.get('/', function(request, response) {\r\n\tresponse.send('Hello World!');\r\n});\r\n*/\r\n\r\n/*\r\napp.set('views', path.join(__dirname, 'views'));\r\napp.set('view engine', 'ejs');\r\napp.get('/', (request, response) => response.render('pages/index'));\r\n*/\r\n\r\n// app.set('view engine', 'handlebars');\r\n\r\napp.get('/', function(request, response) {\r\n\tresponse.sendFile(path.join(__dirname, '../../docs/index.html'));\r\n\t// response.render('docs/index');\r\n});\r\n\r\napp.post('/api/token/rtc', function(request, response) {\r\n\tconst payload = request.body || {};\r\n\tconst duration = 3600;\r\n\tconst timestamp = Math.floor(Date.now() / 1000);\r\n\tconst expirationTime = timestamp + duration;\r\n\tconst uid = payload.uid ? String(payload.uid) : timestamp.toString();\r\n\tconst role = RtcRole.PUBLISHER;\r\n\tconst token = RtcTokenBuilder.buildTokenWithUid(environment.appKey, environment.appCertificate, environment.channelName, uid, role, expirationTime);\r\n\tresponse.send(JSON.stringify({\r\n\t\ttoken: token,\r\n\t}));\r\n});\r\n\r\napp.post('/api/token/rtm', function(request, response) {\r\n\tconst payload = request.body || {};\r\n\tconst duration = 3600;\r\n\tconst timestamp = Math.floor(Date.now() / 1000);\r\n\tconst expirationTime = timestamp + duration;\r\n\tconst uid = payload.uid ? String(payload.uid) : timestamp.toString();\r\n\tconst role = RtmRole.PUBLISHER;\r\n\tconst token = RtmTokenBuilder.buildToken(environment.appKey, environment.appCertificate, uid, role, expirationTime);\r\n\tresponse.send(JSON.stringify({\r\n\t\ttoken: token,\r\n\t}));\r\n});\r\n\r\n/*\r\napp.listen(PORT, () => {\r\n\tconsole.log(`Listening on ${ PORT }`);\r\n});\r\n*/\r\n\r\nhttps\r\n\t.createServer({\r\n\t\tkey: fs.readFileSync(path.join(__dirname, '../../certs/client-key.pem'), 'utf8'),\r\n\t\tcert: fs.readFileSync(path.join(__dirname, '../../certs/client-cert.pem'), 'utf8')\r\n\t}, app)\r\n\t.listen(PORT, function() {\r\n\t\tconsole.log(`Example app listening on port ${PORT}! Go to https://192.168.1.2:${PORT}/`);\r\n\t});\r\n\r\n// IMPORTANT! Build token with either the uid or with the user account. Comment out the option you do not want to use below.\r\n\r\n// Build token with uid\r\n// const token = RtcTokenBuilder.buildTokenWithUid(environment.appKey, environment.appCertificate, environment.channelName, uid, role, expirationTime);\r\n\r\n// Build token with user account\r\n// const token = RtcTokenBuilder.buildTokenWithAccount(environment.appKey, environment.appCertificate, environment.channelName, account, role, expirationTime);\r\n"],"names":["environment","appKey","appCertificate","channelName","port","apiEnabled","paths","models","textures","express","require","https","fs","bodyParser","path","RtcTokenBuilder","RtmTokenBuilder","RtcRole","RtmRole","PORT","process","env","console","log","app","disable","use","static","join","__dirname","urlencoded","extended","json","raw","get","request","response","sendFile","post","payload","body","duration","timestamp","Math","floor","Date","now","expirationTime","uid","String","toString","role","PUBLISHER","token","buildTokenWithUid","send","JSON","stringify","buildToken","createServer","key","readFileSync","cert","listen"],"mappings":"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"}